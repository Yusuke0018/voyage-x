# Voyage 要件定義（MVP）

## 0. 要約（結論）
Voyageは、ホームのビジョンカード→月付き年表→マイルストーン詳細の三層のみ。マイルストーンは「単日／月／期間バー」を混在可。追加・編集・移動・削除の4操作だけで、自由に“足す・消す・ズラす”を実現。保存はLocalStorage、自前JSONで入出力（置換・マージ対応）。通知や習慣・コラボ等は非搭載。美しいダーク/ライトの2テーマに対応（任意）。

---

## 1. 製品ビジョンとスコープ
Voyageは、ゴール（期日）までの距離感を一目で掴ませる“個人用年表”です。
非目標：タスク管理、習慣機能、通知、オンライン同期、ユーザー管理、共同編集、分析ダッシュボード。

---

## 2. 機能要件（MVPの全仕様）

### 2.1 ホーム（ビジョン一覧）
- 表示：タイトル、期日（必須）。
- 操作：新規追加／編集／削除／並べ替え（ドラッグ）。
- 遷移：タップで年表へ。
- 表示ルール：期日が過去でも表示（完了フラグは持たない）。

### 2.2 年表（タイムライン）
- 背景：毎月のラベル（例：2026年8月）を薄く連続表示。四半期はわずかに強調。
- 現在地：縦ラインで固定表示（デバイスのローカル日付）。
- 期日：右端にピン固定。
- ズーム：無し（横スクロールのみ、等速）。
- マイルストーン3型を混在配置：
  - a) 単日：点＋ラベル（YYYY/MM/DD 任意テキスト）
  - b) 月：点＋ラベル（YYYY/MM 任意テキスト）
  - c) 期間バー：帯＋ラベル（YYYY/MM[DD]〜YYYY/MM[DD] 任意テキスト）
- CRUD：タップで追加、タップで編集、ドラッグで移動、長押しで削除、直後のみ“取り消し”1回。

### 2.3 マイルストーン詳細（モーダル）
- 項目：名称、型（単日／月／期間）、開始日、終了日（期間のみ）、自由記述（無制限）。
- 自由記述：数字・長文・改行可、要約なし、オートセーブ。

### 2.4 入出力（必須）
- エクスポート：`voyage-backup-YYYYMMDD.json` をDL。
- インポート：ファイル選択→バリデーション→「置換」or「マージ」を選択。
- マージポリシー：ID衝突時に「上書き／スキップ／複製（新ID）」から選択。
- エラー表示：JSON不正／必須欠落／バージョン非対応を日本語で明示。

### 2.5 設定（任意）
- テーマ切替：ダーク「Midnight Neo」／ライト「Daylight Clean」。
- 日付表示：UIは和式（YYYY年M月／YYYY年M月D日）、保存はISO。

---

## 3. 非機能要件
- ホスティング：GitHub Pages（静的）。
- 保存：LocalStorageのみ、キー`voyage:v1`。
- パフォーマンス：初期表示<1.0s（現行スマホ）、スクロール・ドラッグ60fps目標。
- オフライン：初回ロード後は完全オフライン動作。
- セキュリティ/プライバシー：外部送信なし、解析なし、認証なし。
- アクセシビリティ：コントラスト4.5:1以上、キーボード操作可、reduced motion対応。

---

## 4. データモデル（保存/入出力共通）

```
Root {
  version: "1.0.0",
  exportedAt?: ISO8601,
  visions: Vision[]
}
Vision {
  id: string,            // "vision_xxx"
  title: string,
  dueDate: ISODate,      // YYYY-MM-DD
  milestones: Milestone[]
}
Milestone {
  id: string,            // "ms_xxx"
  type: "day" | "month" | "range",
  startDate: string,     // day=YYYY-MM-DD, month=YYYY-MM, range=YYYY-MM[-DD]
  endDate?: string,      // rangeのみ必須
  description: string
}
```

- 日付は端末TZで解釈。
- 入力の正規化：`YYYY/M` 等は保存時にISOへ正規化。
- 将来拡張用：`version`でマイグレーション制御。

---

## 5. UI/スタイル仕様（最小限で“映える”）
- タイポ：Noto Sans JP / IBM Plex Sans JP、数字は等幅。
- ダーク：背景#0B0F14／カード#11161C／アクセント（#7C3AED→#06B6D4薄グラデ）。
- ライト：背景#F7F8FA／カード#FFFFFF／アクセント#0EA5E9＋#111827。
- モーション：生成0.2sスケールイン、ドラッグ終了0.18sスプリング、削除時軽いバイブ風。
- 年表：極細ライン、月ラベルは薄いグレー、四半期は細線強調、現在地は細縦線。
- テキスト：マイルストーンプレビューは2行、省略「…」、開くと全文。

---

## 6. 画面遷移と主動線
ホーム（一覧）→ 年表（横スクロール）→ 詳細モーダル（編集）→ 年表 に戻る。
“追加→即移動→即保存”が1タップ＋ドラッグで完結。

---

## 7. 受入基準（Acceptance Criteria）
- A1 ホームでビジョンの新規/編集/削除/並べ替えができる。
- A2 年表に毎月ラベルが表示され、現在地と期日が常に可視。
- A3 単日・月・期間バーの各マイルストーンを追加/編集/移動/削除できる。
- A4 期間バーは左右端で幅変更ができ、月/日単位双方に追従。
- A5 全変更が即LocalStorage保存され、再読込しても一致。
- A6 JSONエクスポートが行え、同データをインポート（置換/マージ）できる。
- A7 不正JSONは読み込まず、理由が日本語で表示される。
- A8 オフラインで全機能が利用できる。
- A9 スクロール・ドラッグが滑らか（カクつきが許容範囲内）。
- A10 アクセシビリティ基本（コントラスト／フォーカス／キーボード）が満たされる。

---

## 8. 手動テスト項目（抜粋）
- 単日→月→期間へ型を切替／逆方向も可。
- 月跨ぎ・年跨ぎ（12月→翌1月）で表示崩れなし。
- うるう年（2028/2/29）で単日配置可。
- 過去日・期日前後のマイルストーン配置可。
- LocalStorage満杯近傍で警告表示→エクスポート誘導。
- 同一IDを含むインポートで上書き/スキップ/複製が期待通り。
- `version`不一致で拒否＋メッセージ。

---

## 9. リリース計画
- M0（MVP）：ホーム・年表・3型マイルストーンCRUD・LocalStorage保存・入出力。
- M1（磨き）：テーマ切替・モーション微調整・アクセシビリティ調整。
- M2（任意）：PWA化（オフラインキャッシュ強化）、設定UIの分離。

---

## 10. リスクと対策
- LocalStorage上限（約5MB）：テキスト肥大時に容量推定＆バックアップ誘導。
- 日付解釈差：保存をISOに統一、UIは和式でレンダリング。
- 長文表示：詳細モーダルは自動拡張＋内部スクロール、年表は2行プレビュー固定。
- GitHub Pagesのパス：相対パスで実装、サブパス公開でも動作。

---

## 11. リポジトリ構成（静的）
- `/index.html`（3画面を1ページで）
- `/assets/voyage.css`（トークン＋コンポーネント）
- `/assets/voyage.js`（状態管理・描画・入出力）
- `/assets/favicon.*`（任意）
- `/LICENSE` `/README.md`（運用説明）

---

## 12. Claude Code 用プロンプト雛形

### 12.1 実装ユニット依頼（例：年表の月背景）
「Voyage（個人用年表アプリ）の年表コンポーネントを実装してください。要件：

1. 横スクロールの一本線、2) 毎月のラベル（YYYY年M月）を薄く等間隔で描画、3) 現在地の縦線固定、4) 期日ピン固定、5) 60fps目標。
   入力：ビジョンのdueDate（ISO）。出力：DOM更新関数`renderTimeline(container, state)`。依存：外部ライブラリ不可。スタイルはCSSクラスを割当。日付処理は標準Dateで。DoD：スクロールしても月ラベルと現在地表示がブレず、モバイルで指の追従が滑らか。」

### 12.2 レビュー依頼（例：マイルストーンCRUD）
「マイルストーンの追加/編集/移動/削除の実装を静的検査し、境界条件（単日↔月↔期間の相互変換、年跨ぎ、うるう年）での欠陥を指摘し、修正パッチ案を提示してください。副作用：LocalStorageへの即時保存`saveState(state)`の呼出しを必ず1回に抑える。」

### 12.3 入出力実装依頼
「JSONエクスポート/インポートを実装。`exportState(state)`はBlob→DL、`importState(file, mode)`は`mode=replace|merge`で検証→反映。マージ時のID衝突解決（上書き/スキップ/複製）はUIで選択済みとして、実装は与えられた`strategy`を適用。DoD：往復（エクスポート→インポート）でビット等価。」

---

## 13. 実装TODO（Claudeに投げる順）— 各項目にDoDを付与

### A. 基盤
- A1 日付ユーティリティ（ISO⇄表示、月境界計算、うるう年）
  - DoD：単体テストで代表ケース10件が一致。
- A2 状態管理（State型、ID採番、バージョン）
  - DoD：新規/編集/削除後のStateが不変更新で整合。

### B. 保存/復元
- B1 LocalStorageラッパ（load/save/clear、容量推定）
  - DoD：連続50回更新で破損なし、容量警告が閾値到達で出る。
- B2 エクスポート/インポート（置換/マージ/重複処理）
  - DoD：サンプル3種で往復一致、エラーメッセージ日本語。

### C. UI
- C1 ホーム（カード一覧、新規/編集/削除/並べ替え）
  - DoD：タップで遷移、並べ替えがドラッグ1秒内で反映。
- C2 年表（毎月ラベル、現在地、期日ピン、横スクロール）
  - DoD：60fpsに近い操作感、ズレや滲みなし。
- C3 マイルストーンCRUD（単日・月・期間）
  - DoD：追加/編集/移動/削除/取り消し、型相互変換が安定。
- C4 詳細モーダル（自由記述オートセーブ、長文対応）
  - DoD：2万文字でスクロール滑らか、保存遅延なし。
- C5 テーマ切替（任意）
  - DoD：ダーク/ライトで主要要素のコントラスト基準達成。

### D. QA/配布
- D1 手動テストスクリプト実行（本書8章に準拠）
  - DoD：A1〜A10を満たす。
- D2 GitHub Pages公開（相対パス検証）
  - DoD：`https://<user>.github.io/<repo>/` 下で全機能動作。

---

## 14. 未決定事項（推奨値を提示）
- 取り消しの時間窓：2秒（推奨）。
- 最大文字数：内部上限なし、DOM描画の実務上は1マイルストーン20万字程度まで（推奨は1万字以下）。
- テーマ既定：ダーク（推奨、視覚的高揚感のため）。

---

## まずはここから（今日やること）
1. この要件定義を`/docs/requirements.md`としてリポジトリ初期化。
2. Claudeに「A1→A2→B1→C2→C3→B2→C1→C4→C5→D2」の順で本書のプロンプト雛形を投げる。
3. エクスポート→空状態→インポート（置換/マージ）の往復テストを最初のマイルストーン作成後に必ず1回実施。

短い再要約：Voyageは三層・四操作・三型マイルストーンだけの“極小核”。LocalStorage＋JSON入出力で完全個人仕様、GitHub Pagesで即配布可能です。上のTODO順でClaudeに依頼すれば、余計な機能ゼロで美しいMVPに直行できます。

