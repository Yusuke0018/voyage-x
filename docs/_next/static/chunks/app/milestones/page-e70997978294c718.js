(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[392],{1362:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},2673:(e,t,s)=>{Promise.resolve().then(s.bind(s,3231))},3231:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(5155),i=s(2115),l=s(63),r=s(3209),n=s(7003),c=s(6170),d=s(235),o=s(7001),m=s(4679),x=s(6191),h=s(1847);let p=(0,h.A)("milestone",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]]),u=(0,h.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var j=s(9051),g=s(5740),y=s(6485),N=s(2685),v=s(1362);let w=(0,h.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var f=s(5229);function k(e){let{milestoneId:t,tasks:s,onCreateTask:l,onUpdateTaskStatus:d,onRefresh:o}=e,[m,h]=(0,i.useState)(!1),[p,u]=(0,i.useState)(""),[g,y]=(0,i.useState)("medium"),N=async()=>{p.trim()&&(await l({milestoneId:t,title:p,status:"todo",priority:g}),u(""),y("medium"),h(!1),await o())},k=async(e,t)=>{await d(e,{todo:"in_progress",in_progress:"done",done:"todo",postponed:"todo"}[t]),await o()},A=[...s].sort((e,t)=>{let s={in_progress:0,todo:1,postponed:2,done:3},a=s[e.status]-s[t.status];if(0!==a)return a;let i={high:0,medium:1,low:2};return i[e.priority]-i[t.priority]});return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h3",{className:"font-medium",children:"タスク一覧"}),(0,a.jsxs)(n.$,{size:"sm",variant:"outline",onClick:()=>h(!0),children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-1"}),"タスクを追加"]})]}),m&&(0,a.jsx)(r.Zp,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.p,{value:p,onChange:e=>u(e.target.value),placeholder:"新しいタスクを入力",onKeyPress:e=>"Enter"===e.key&&N(),autoFocus:!0}),(0,a.jsxs)("select",{value:g,onChange:e=>y(e.target.value),className:"px-3 py-2 border rounded-md",children:[(0,a.jsx)("option",{value:"high",children:"高"}),(0,a.jsx)("option",{value:"medium",children:"中"}),(0,a.jsx)("option",{value:"low",children:"低"})]}),(0,a.jsx)(n.$,{onClick:N,size:"sm",children:"追加"}),(0,a.jsx)(n.$,{onClick:()=>{h(!1),u("")},size:"sm",variant:"ghost",children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]})}),0===A.length?(0,a.jsx)(r.Zp,{className:"p-6 text-center text-muted-foreground",children:"タスクがありません"}):A.map(e=>(0,a.jsx)(r.Zp,{className:"p-3 transition-opacity ".concat("done"===e.status?"opacity-60":""),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(n.$,{variant:"ghost",size:"sm",className:"p-0 h-auto",onClick:()=>k(e.id,e.status),children:(e=>{switch(e){case"done":return(0,a.jsx)(v.A,{className:"w-5 h-5 text-green-600"});case"in_progress":return(0,a.jsx)(w,{className:"w-5 h-5 text-blue-600"});case"postponed":return(0,a.jsx)(j.A,{className:"w-5 h-5 text-gray-400"});default:return(0,a.jsx)(j.A,{className:"w-5 h-5"})}})(e.status)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"".concat("done"===e.status?"line-through text-muted-foreground":""),children:e.title}),e.description&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:e.description})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat((e=>{switch(e){case"high":return"text-red-600 bg-red-50";case"low":return"text-green-600 bg-green-50";default:return"text-yellow-600 bg-yellow-50"}})(e.priority)),children:"high"===e.priority?"高":"medium"===e.priority?"中":"低"})]})},e.id))]})}function A(){let e=(0,l.useSearchParams)().get("goalId"),{isReady:t,getGoals:s,getMilestonesByGoal:h,createMilestone:v,getTasksByMilestone:w,createTask:f,updateTaskStatus:A}=(0,N.t)(),[b,C]=(0,i.useState)(null),[S,D]=(0,i.useState)([]),[_,z]=(0,i.useState)({}),[I,M]=(0,i.useState)(null),[$,O]=(0,i.useState)(!1),[P,Z]=(0,i.useState)({title:"",description:"",targetDate:new Date(Date.now()+7776e6)});(0,i.useEffect)(()=>{t&&e&&E()},[t,e]);let E=async()=>{if(!e)return;let t=(await s()).find(t=>t.id===e);t&&(C(t),D(await h(e)))},T=async()=>{P.title.trim()&&e&&(await v({goalId:e,title:P.title,description:P.description,targetDate:P.targetDate,completed:!1,order:S.length}),await E(),O(!1),Z({title:"",description:"",targetDate:new Date(Date.now()+7776e6)}))},J=async e=>{let t=await w(e);z(s=>({...s,[e]:t}))},F=async e=>{I===e?M(null):(M(e),_[e]||await J(e))},q=async e=>{let t=localStorage.getItem("openai_api_key");if(!t)return void alert("OpenAI APIキーを設定してください");try{let s=await fetch("/api/ai/decompose",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({milestone:e,apiKey:t})}),a=await s.json();if(a.tasks&&Array.isArray(a.tasks)){for(let t of a.tasks)await f({milestoneId:e.id,title:t.title,description:t.description||"",status:"todo",priority:t.priority||"medium"});await J(e.id),M(e.id)}}catch(e){console.error("AI分解エラー:",e),alert("タスクの分解に失敗しました")}};return t?b?(0,a.jsxs)("div",{className:"container mx-auto p-4 max-w-7xl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[(0,a.jsx)("a",{href:"/goals",className:"hover:text-primary",children:"目標"}),(0,a.jsx)("span",{children:"/"}),(0,a.jsx)("span",{children:b.title})]}),(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold",children:[b.title,"への航路"]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"宝島にたどり着くまでの島々を設定しましょう"})]}),(0,a.jsxs)(m.lG,{open:$,onOpenChange:O,children:[(0,a.jsx)(m.zM,{asChild:!0,children:(0,a.jsxs)(n.$,{size:"lg",children:[(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"})," マイルストーンを追加"]})}),(0,a.jsxs)(m.Cf,{className:"sm:max-w-[525px]",children:[(0,a.jsx)(m.c7,{children:(0,a.jsx)(m.L3,{children:"新しいマイルストーン"})}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"title",children:"マイルストーン名"}),(0,a.jsx)(c.p,{id:"title",value:P.title,onChange:e=>Z({...P,title:e.target.value}),placeholder:"例: 基本機能の実装"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"description",children:"説明"}),(0,a.jsx)(o.T,{id:"description",value:P.description,onChange:e=>Z({...P,description:e.target.value}),placeholder:"このマイルストーンの詳細",rows:3})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(d.J,{htmlFor:"targetDate",children:"目標日"}),(0,a.jsx)(c.p,{id:"targetDate",type:"date",value:P.targetDate.toISOString().split("T")[0],onChange:e=>Z({...P,targetDate:new Date(e.target.value)})})]})]}),(0,a.jsxs)(m.Es,{children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>O(!1),children:"キャンセル"}),(0,a.jsx)(n.$,{onClick:T,children:"作成"})]})]})]})]})]}),0===S.length?(0,a.jsxs)(r.Zp,{className:"p-12 text-center",children:[(0,a.jsx)(p,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"まだマイルストーンがありません"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"最初の中間目標を設定しましょう"})]}):(0,a.jsx)("div",{className:"space-y-4",children:S.map((e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsx)(r.Zp,{className:"cursor-pointer",onClick:()=>F(e.id),children:(0,a.jsx)(r.aR,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.completed?(0,a.jsx)(u,{className:"h-6 w-6 text-green-600"}):(0,a.jsx)(j.A,{className:"h-6 w-6"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(r.ZB,{children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(n.$,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),q(e)},children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-1"}),"AI分解"]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,a.jsx)(y.A,{className:"h-4 w-4 inline mr-1"}),new Date(e.targetDate).toLocaleDateString("ja-JP")]})]})]})})}),I===e.id&&(0,a.jsx)("div",{className:"ml-8 mt-3",children:(0,a.jsx)(k,{milestoneId:e.id,tasks:_[e.id]||[],onCreateTask:async e=>{await f(e),await J(e.milestoneId)},onUpdateTaskStatus:A,onRefresh:()=>J(e.id)})})]},e.id))})]}):(0,a.jsx)("div",{className:"container mx-auto p-4",children:(0,a.jsxs)(r.Zp,{className:"p-12 text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"目標が選択されていません"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"目標ページから目標を選択してください"}),(0,a.jsx)(n.$,{className:"mt-4",onClick:()=>window.location.href="/goals",children:"目標ページへ"})]})}):(0,a.jsx)("div",{className:"container mx-auto p-4",children:"読み込み中..."})}function b(){return(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{className:"container mx-auto p-4",children:"読み込み中..."}),children:(0,a.jsx)(A,{})})}},5740:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]])},9051:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(1847).A)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])}},e=>{e.O(0,[140,894,35,441,255,358],()=>e(e.s=2673)),_N_E=e.O()}]);