<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="screen-orientation" content="portrait">
    <meta name="orientation" content="portrait">
    <title>Orientation Lock Test - Voyage</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 8px 4px;
        }
        button:hover { background: #0056b3; }
        
        .metrics {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
        }
        
        h1 { color: #333; margin-bottom: 8px; }
        h2 { color: #666; font-size: 18px; margin-top: 24px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Orientation Lock Test</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã§Voyageã®ç”»é¢å›è»¢é˜²æ­¢æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        
        <h2>ğŸ“± Device Information</h2>
        <div id="deviceInfo" class="metrics"></div>
        
        <h2>ğŸ”’ API Availability</h2>
        <div id="apiStatus"></div>
        
        <h2>ğŸ“ Current Orientation</h2>
        <div id="orientationInfo" class="metrics"></div>
        
        <h2>ğŸ¯ Lock Tests</h2>
        <button onclick="testModernAPI()">Test Modern Screen API</button>
        <button onclick="testLegacyAPI()">Test Legacy APIs</button>
        <button onclick="testFullscreen()">Test Fullscreen + Lock</button>
        <button onclick="refreshMetrics()">Refresh Metrics</button>
        
        <h2>ğŸ“Š Test Results</h2>
        <div id="testResults"></div>
        
        <h2>âš ï¸ Instructions</h2>
        <div class="info">
            <strong>Testing Steps:</strong><br>
            1. Open this page on your Android device<br>
            2. Try to rotate the device to landscape<br>
            3. Click the test buttons<br>
            4. Check if orientation is locked to portrait<br>
            5. Note any rotation behavior in the results
        </div>
    </div>

    <script>
        function getDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                screenWidth: screen.width,
                screenHeight: screen.height,
                screenAvailWidth: screen.availWidth,
                screenAvailHeight: screen.availHeight,
                windowWidth: window.innerWidth,
                windowHeight: window.innerHeight,
                devicePixelRatio: window.devicePixelRatio,
                colorDepth: screen.colorDepth,
                pixelDepth: screen.pixelDepth
            };
            return info;
        }

        function checkAPIAvailability() {
            const apis = {
                'Screen Orientation API': !!(screen.orientation && screen.orientation.lock),
                'Legacy lockOrientation': !!screen.lockOrientation,
                'Legacy mozLockOrientation': !!screen.mozLockOrientation,
                'Legacy msLockOrientation': !!screen.msLockOrientation,
                'Legacy webkitLockOrientation': !!screen.webkitLockOrientation,
                'Fullscreen API': !!document.documentElement.requestFullscreen,
                'Wake Lock API': !!navigator.wakeLock,
                'Visual Viewport API': !!window.visualViewport,
                'PWA Display Mode': window.matchMedia('(display-mode: standalone)').matches
            };
            return apis;
        }

        function getCurrentOrientation() {
            const info = {};
            
            if (screen.orientation) {
                info.orientationType = screen.orientation.type;
                info.orientationAngle = screen.orientation.angle;
            } else {
                info.orientationAngle = screen.orientation || window.orientation || 0;
            }
            
            info.windowDimensions = `${window.innerWidth} x ${window.innerHeight}`;
            info.screenDimensions = `${screen.width} x ${screen.height}`;
            info.isLandscape = window.innerWidth > window.innerHeight;
            info.aspectRatio = (window.innerWidth / window.innerHeight).toFixed(2);
            
            return info;
        }

        function displayDeviceInfo() {
            const info = getDeviceInfo();
            const deviceInfoEl = document.getElementById('deviceInfo');
            deviceInfoEl.innerHTML = Object.entries(info)
                .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                .join('<br>');
        }

        function displayAPIStatus() {
            const apis = checkAPIAvailability();
            const statusEl = document.getElementById('apiStatus');
            statusEl.innerHTML = Object.entries(apis)
                .map(([api, available]) => 
                    `<div class="status ${available ? 'success' : 'error'}">
                        ${available ? 'âœ…' : 'âŒ'} ${api}
                    </div>`
                ).join('');
        }

        function displayOrientationInfo() {
            const info = getCurrentOrientation();
            const orientationEl = document.getElementById('orientationInfo');
            orientationEl.innerHTML = Object.entries(info)
                .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                .join('<br>');
        }

        function addTestResult(test, result, success) {
            const resultsEl = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<strong>${test}:</strong> ${result}`;
            resultsEl.appendChild(resultDiv);
        }

        async function testModernAPI() {
            try {
                if (screen.orientation && screen.orientation.lock) {
                    await screen.orientation.lock('portrait-primary');
                    addTestResult('Modern Screen Orientation API', 'Lock successful', true);
                } else {
                    addTestResult('Modern Screen Orientation API', 'API not available', false);
                }
            } catch (error) {
                addTestResult('Modern Screen Orientation API', `Error: ${error.message}`, false);
            }
        }

        function testLegacyAPI() {
            const methods = [
                'lockOrientation',
                'mozLockOrientation', 
                'msLockOrientation',
                'webkitLockOrientation'
            ];
            
            let success = false;
            
            for (const method of methods) {
                if (screen[method]) {
                    try {
                        const result = screen[method]('portrait-primary') || screen[method]('portrait');
                        if (result) {
                            addTestResult(`Legacy ${method}`, 'Lock successful', true);
                            success = true;
                            break;
                        }
                    } catch (error) {
                        addTestResult(`Legacy ${method}`, `Error: ${error.message}`, false);
                    }
                }
            }
            
            if (!success) {
                addTestResult('Legacy APIs', 'No working legacy API found', false);
            }
        }

        async function testFullscreen() {
            try {
                if (document.documentElement.requestFullscreen) {
                    await document.documentElement.requestFullscreen();
                    setTimeout(async () => {
                        try {
                            if (screen.orientation && screen.orientation.lock) {
                                await screen.orientation.lock('portrait-primary');
                                addTestResult('Fullscreen + Lock', 'Success with modern API', true);
                            } else {
                                addTestResult('Fullscreen + Lock', 'Fullscreen OK, but no lock API', false);
                            }
                        } catch (error) {
                            addTestResult('Fullscreen + Lock', `Lock failed: ${error.message}`, false);
                        }
                    }, 100);
                } else {
                    addTestResult('Fullscreen API', 'Not available', false);
                }
            } catch (error) {
                addTestResult('Fullscreen API', `Error: ${error.message}`, false);
            }
        }

        function refreshMetrics() {
            displayDeviceInfo();
            displayAPIStatus();
            displayOrientationInfo();
            addTestResult('Metrics Refresh', 'Updated successfully', true);
        }

        // Initialize the test page
        function init() {
            displayDeviceInfo();
            displayAPIStatus();
            displayOrientationInfo();
            
            // Listen for orientation changes
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    displayOrientationInfo();
                    addTestResult('Orientation Change', 'Detected orientation change event', false);
                }, 100);
            });
            
            window.addEventListener('resize', () => {
                displayOrientationInfo();
            });
        }

        // Start when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>